<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StayAhead - Your Score & Leaderboard</title>
    <!--Boostrap Style-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <!--External css-->
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>

<body>
    <!--Nav bar-->
    <section class="non-mobile">
        <nav>
            <div class="logo p-2">
                <a class="nav-link text-white justify-content-start" href="about.html">
                    <img src="assets\images\v1.png">
                    StayAhead
                </a>
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <div>
                    <ul class="nav justify-content-center">
                        <li class="nav-item px-1">
                            <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                        </li>
                        <li class="nav-item px-1">
                            <a class="nav-link" href="about.html">About</a>
                        </li>
                        <li class="nav-item px-1">
                            <a class="nav-link" href="scamalerts.html">Scam Alerts</a>
                        </li>
                        <li class="nav-item px-1">
                            <a class="nav-link" href="game.html">Game</a>
                        </li>
                        <li class="nav-item px-1">
                            <a class="nav-link" id="loginLink" href="signuplogin.html">Sign-up/Login</a>
                        </li>
                        <li class="nav-item px-1">
                            <a class="nav-link" id="logoutLink" href="#">Logout</a>
                        </li>
                    </ul>
                </div>
                <!-- Profile Container -->
                <div id="profileContainer" class="text-center pe-4">
                    <div class="bg-secondary-subtle rounded-circle d-inline-flex align-items-center justify-content-center"
                        style="width: 25px; height: 25px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="gray"
                            class="bi bi-person-fill" viewBox="0 0 16 16">
                            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                        </svg>
                    </div>
                    <p id="profileNameContainer" class="mb-0 fw-lighter pt-1 text-white" style="font-size: 0.8rem;">
                        Welcome User</p>
                </div>
            </div>
        </nav>
    </section>
    <!--navbar   mobile mode-->
    <section class="mobile d-sm-none">
        <nav class="navbar navbar-expand-lg navbar-dark position-fixed w-100" aria-label="First navbar example">
            <div class="container-fluid">
                <div class="mobile-nvbg d-flex justify-content-between w-100">
                    <div class="logo p-2">
                        <a class="nav-link text-white justify-content-center" href="about.html">
                            <img src="assets\images\v1.png">
                            StayAhead
                        </a>
                    </div><button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarsExample01" aria-controls="navbarsExample01" aria-expanded="false"
                        aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
                </div>
                <div class="navbar-collapse collapse" id="navbarsExample01">
                    <ul class="navbar-nav me-auto mb-2 ">
                        <li class="nav-item"> <a class="nav-link active" aria-current="page" href="index.html">Home</a>
                        </li>
                        <li class="nav-item"> <a class="nav-link" href="about.html">About</a> </li>
                        <li class="nav-item"> <a class="nav-link" href="scamalerts.html">Scam Alerts</a> </li>
                        <li class="nav-item"> <a class="nav-link" href="game.html">Game</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="m_loginLink"
                                href="signuplogin.html">Signup/Login</a> </li>
                        <li class="nav-item"> <a class="nav-link" id="m_logoutLink" href="#">Logout</a> </li>
                    </ul>
                </div>
            </div>
        </nav>
    </section>
    <!--Leaderboard Content-->
    <section class="content">
        <div class="leaderboard-container">
            <!-- LEFT COLUMN -->
            <div class="left-column">
                <!-- YOUR SCORE CARD (CENTERED) -->
                <div class="leaderboard-card">
                    <h1 class="card-title" id="userIdcard">
                        <span class="icon"></span>
                        USERID :
                    </h1>
                    <p class="card-subtitle">Campaign Period: Jan 1 - Jan 31, 2026</p>

                    <p class="section-label">Here's your current standing and the top 10 players:</p>

                    <div class="score-box">
                        <span class="score-badge">YOUR SCORE</span>
                        <h2 class="score-username">You</h2>
                        <p class="score-subtitle">Your Current Rank</p>

                        <div class="score-metrics">
                            <div class="metric">
                                <p class="metric-label">Your Score</p>
                                <p class="metric-value" id="userScore">150</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TOP 5 PLAYERS CARD -->
                <div class="leaderboard-card">
                    <p class="top-5-title">TOP 5 PLAYERS</p>

                    <div class="top-5-section">
                        <div class="leaderboard-item">
                            <span class="tableid"></span>
                            <span class="leaderid"></span>
                            <span class="leaderscore"></span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="tableid"></span>
                            <span class="leaderid"> </span>
                            <span class="leaderscore"></span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="tableid"></span>
                            <span class="leaderid"></span>
                            <span class="leaderscore"></span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="tableid"></span>
                            <span class="leaderid"></span>
                            <span class="leaderscore"></span>
                        </div>
                        <div class="leaderboard-item">
                            <span class="tableid"></span>
                            <span class="leaderid"> </span>
                            <span class="leaderscore"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN - ACHIEVEMENTS & REDEMPTION -->
            <div class="leaderboard-card">
                <h1 class="achievement-card-title">
                    <span class="icon"></span>
                    Redemption Details
                </h1>

                <div class="achievement-list">
                    <div class="achievement-item">
                        <span class="achievement-check">‚úì</span>
                        <span class="achievement-text">Highest score of the campaign</span>
                    </div>
                    <div class="achievement-item">
                        <span class="achievement-check">‚úì</span>
                        <span class="achievement-text">Consistent top 3 placement throughout</span>
                    </div>
                    <div class="achievement-item">
                        <span class="achievement-check">‚úì</span>
                        <span class="achievement-text">Unlocked all bonus challenges</span>
                    </div>
                    <div class="achievement-item">
                        <span class="achievement-check">‚úì</span>
                        <span class="achievement-text">Featured on leaderboard 28+ days</span>
                    </div>

                    <div class="reward-status">
                        <p class="reward-status-text">
                            <span class="reward-status-label">Reward Status:</span>
                            Special redemption offer unlocked and will be available after campaign ends on Jan 31, 2026
                        </p>
                    </div>
                </div>

                <!-- REDEEM SECTION -->
                <div class="redeem-section">
                    <div class="redeem-item-preview">
                        <img id="redemptionImage" src="https://via.placeholder.com/300x300?text=Redemption+Item"
                            alt="Redemption Item">
                    </div>
                    <button id="redeemButton" class="redeem-button redeem-button--locked" disabled>
                        <span class="lock-icon">üîí</span>
                        <span>Available After Campaign Ends</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!--Footer start here-->
    <!--Footer nav links-->
    <footer>
        <div>
            <nav class="lowernav justify-content-center">
                <ul class="nav justify-content-center">
                    <li class="nav-item px-1">
                        <a class="nav-link" aria-current="page" href="/index.html">Home</a>
                    </li>
                    <li class="nav-item px-1">
                        <a class="nav-link" href="/about.html">About</a>
                    </li>
                    <li class="nav-item px-1">
                        <a class="nav-link" href="/scamalerts.html">Scam Alerts</a>
                    </li>
                    <li class="nav-item px-1">
                        <a class="nav-link" href="#">Game</a>
                    </li>
                    <li class="nav-item px-1">
                        <a class="nav-link active" href="/leaderboard.html">Leaderboard</a>
                    </li>
                    <li class="nav-item px-1">
                        <a class="nav-link" href="/signuplogin.html">Sign-up/Login</a>
                    </li>
                </ul>
            </nav>
        </div>
        <!--Disclaimer section-->
        <div>
            <div class="disclaimer justify-content-center">
                <h6 class="text-center">
                    DISCLAIMERS: Information on this site is for general education only and does not constitute
                    financial or investment advice.
                    StayAhead is not liable for any decisions made based on our content. Please consult a qualified
                    professional for personalised guidance.
                </h6>
            </div>
        </div>
        <!--Organization & Copyright-->
        <div class="team3">
            <div>
                <h5 class=class="card-footer text-body-secondary justify-content-center">JFSD07 Team 3</h5>
                <p> by Generation Singapore in partnership with Microsoft & Temasek Poly</p>
            </div>
            <div>
                <h5>&copy; 2025 StayAhead &trade; All rights reserved</h5>
            </div>
        </div>
    </footer>

    <!--Boostrap Javascript Library-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous">
        </script>
    <script src="script/const.js"></script>
    <script src="script/auth.js"></script>
    <script src="script/components/Spinner.js"></script>
    <script src="script/loader.js"></script>

    <script src="script/boostrap-ftns.js"></script>
    <script src="script/form-validate.js"></script>


    <!-- Redeem Button Logic -->
    <script>
        // Redeem Button Logic
        const redeemButton = document.getElementById('redeemButton');
        const redemptionImage = document.getElementById('redemptionImage');

        // Check if campaign has ended
        function checkCampaignStatus() {
            const campaignEndDate = new Date('2026-02-31').getTime();
            const currentDate = new Date().getTime();

            if (currentDate >= campaignEndDate) {
                // Unlock button
                redeemButton.classList.remove('redeem-button--locked');
                redeemButton.classList.add('redeem-button--unlocked');
                redeemButton.disabled = false;
                redeemButton.innerHTML = '<span class="lock-icon">üéÅ</span><span>Redeem Now</span>';
            }
        }

        // // Change image dynamically
        // function setRedemptionImage(imageUrl) {
        //     redemptionImage.src = imageUrl;
        // }

        // Redeem button click handler
        // redeemButton.addEventListener('click', function () {
        //     if (!redeemButton.disabled) {
        //         alert('Thank you for redeeming! Your reward has been processed.');
        //         // Add your redemption logic here
        //         const formData = new FormData();

        //         formData.append("email", email);
        //         formData.append("voucher", voucherId);

        //         try {
        //             const response = await fetch(, {
        //                 method: 'GET',
        //                 body: formData
        //             });

        //             if (response.ok) {
        //                 const userResult = await response.json();
        //                 document.getElementById('scoreUpdate').innerText = userResult.message;
        //             }
        //         } catch (error) {
        //             console.log(error);
        //             document.getElementById('scoreUpdate').textContent = 'An error occured updating the score. Try again later.';
        //         }
        //     }
        // });

        // Initialize on page load
        checkCampaignStatus();
        function maskEmail(email) {
            // Replaces the 4 characters before the @ with ****
            return email.replace(/(.{3})@/, '***@');
        }
        //get leaderboard
        async function printHighscore() {      // update the leaderboard with the new scores

            let leaderboardtableId = document.querySelectorAll('.tableid');
            let leaderboardId = document.querySelectorAll('.leaderid');
            let leaderboardScore = document.querySelectorAll('.leaderscore');

            try {
                const response = await fetch(_ENDPOINT_TOPFIVE, {
                    method: 'GET',
                });

                if (response.ok) {
                    const top5 = await response.json();

                    const sortedTop5 = Object.fromEntries(Object.entries(top5).sort(([, a], [, b]) => b - a)); // Use 'b - a' for descending
                    Object.entries(sortedTop5).forEach(([email, score], index) => {
                        leaderboardtableId[index].textContent = index + 1;
                        leaderboardId[index].textContent = maskEmail(email);
                        leaderboardScore[index].textContent = score;
                    });
                }
            } catch (error) {
                alert("An error occured");
            }
        }

        async function getUserInfo() {

            const users = decodeUser(localStorage.getItem(_USERTOKEN));
            try {
                const response = await fetch(`${_ENDPOINT_USERINFOR}?email=${users.email}`, {
                    method: 'GET',

                });

                if (response.ok) {
                    const userDto = await response.json();
                    console.log(userDto);
                    document.getElementById("userIdcard").textContent = `Your USERID : ${userDto.userid}`;
                    userDto.score > 0 ?
                        document.getElementById("userScore").textContent = ` Current HighScore : ${userDto.score}` :
                        document.getElementById("userScore").textContent = `You have not Attempted the game.`;

                }

            } catch (error) {
                alert("An error occured");
            }
        }
        printHighscore();
        getUserInfo();

        // Optional: Update every minute to check campaign status
        setInterval(checkCampaignStatus, 60000);
        // get personal score

    </script>
</body>

</html>